---
import "../styles/global.css";
import "../styles/markdown.css";
import Header from "../components/Header.astro";
import { ClientRouter } from "astro:transitions";
import SEO from "../components/SEO.astro";
import Footer from "../components/Footer.astro";

const {
  title: pageTitle,
  date: pageDate,
  description: pageDescription,
  image: pageImage,
  frontmatter,
} = Astro.props;

const title = frontmatter?.title ?? pageTitle;
const date = frontmatter?.date ?? pageDate;
const description = frontmatter?.description ?? pageDescription;
const image = frontmatter?.image ?? pageImage ?? "/og/default.png";

const cleanPath = Astro.url.pathname.replace(/\/+$/, "");
const isBlogIndex = cleanPath === "/blog";

// Build canonical URL dynamically
const canonical = new URL(Astro.url.pathname, Astro.site).toString();
const ogImage = image.startsWith("http") ? image : `${Astro.site}${image}`;
---

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" type="image/png" href="/favicon.png" />

  <!-- SEO Component -->
  <SEO
    title={title ? `${title} | Atharva Jadhav` : "Atharva Jadhav"}
    description={description ??
      "Blog by Atharva Jadhav — Software Engineer sharing projects, learnings, and experiences."}
    canonical={canonical}
    image={ogImage}
    type={isBlogIndex ? "website" : "article"}
  />

  <ClientRouter />
</head>

<body>
  <!-- Header -->
  <Header active="blog" />

  <main class="blog-container">
    {
      !isBlogIndex && (
        <a href="/blog" class="back-to-blog" aria-label="Back to blog list">
          ← Back to Blog
        </a>
      )
    }

    <h1 class="blog-title">{title}</h1>
    {date && <p class="blog-date">{date}</p>}
    {description && <p class="blog-desc">{description}</p>}

    <article class="markdown">
      <slot />
    </article>
  </main>

  <!-- Footer -->
  <Footer />
</body>

<style>
  /* PAGE */
  .blog-container {
    max-width: 800px;
    margin: 4rem auto 2rem;
    padding: 0 1.2rem;
  }

  /* TITLE */
  .blog-title {
    font-size: 2.3rem;
    margin: 3rem 0 1.5rem;
    font-weight: 700;
    color: var(--text-color, #fff);
  }

  .blog-date {
    color: #00ff90;
    font-size: 0.95rem;
    font-weight: 600;
    letter-spacing: 0.3px;
    margin-bottom: 0.8rem;
  }

  .blog-desc {
    margin-bottom: 2.5rem;
    opacity: 0.95;
    font-size: 1.1rem;
    line-height: 1.6;
    border-bottom: 1px solid var(--color-border);
    padding-bottom: 1.5rem;
    color: var(--text-color, #e0e0e0);
  }

  /* CONTENT */
  .blog-content {
    max-width: 70ch;
    line-height: 1.75;
    font-size: 1.1rem;
  }

  .blog-content ul ul,
  .blog-content ol ol {
    margin-left: 1.5rem;
  }

  /* Back button */
  .back-to-blog {
    padding-bottom: 0.6rem;
    border-bottom: 1px solid var(--color-border);
    display: inline-block;
    margin-bottom: 1.8rem;
    font-size: 0.95rem;
    font-weight: 600;
    color: var(--color-accent);
    text-decoration: none;
    opacity: 0.9;
    transition:
      opacity 0.15s ease,
      transform 0.15s ease;
    cursor: pointer;
  }

  .back-to-blog:hover {
    opacity: 1;
    transform: translateX(-4px);
  }
</style>
